<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>Diamond Slots üíé</title>
<style>
  body {
    background: radial-gradient(circle at center, #0a0020, #000);
    color: #fff;
    font-family: "Poppins", sans-serif;
    text-align: center;
    overflow: hidden;
  }

  h1 {
    font-size: 2.5em;
    color: #00ffff;
    text-shadow: 0 0 10px #0ff, 0 0 20px #00f0f0;
    margin-top: 30px;
  }

  #slot-container {
    display: flex;
    justify-content: center;
    margin: 50px auto;
    gap: 20px;
  }

  .reel {
    width: 100px;
    height: 100px;
    background: #111;
    border: 3px solid #00ffff;
    border-radius: 10px;
    font-size: 2em;
    display: flex;
    align-items: center;
    justify-content: center;
    box-shadow: 0 0 20px #00ffff;
  }

  button {
    background: linear-gradient(45deg, #00ffff, #ff00ff);
    color: #000;
    font-size: 1.2em;
    padding: 10px 25px;
    border: none;
    border-radius: 10px;
    box-shadow: 0 0 15px #00ffff;
    cursor: pointer;
    margin-top: 20px;
    transition: 0.3s;
  }

  button:hover {
    transform: scale(1.05);
    box-shadow: 0 0 25px #ff00ff;
  }

  #diamond-display {
    margin-top: 20px;
    font-size: 1.5em;
    color: #00ffcc;
  }

  #jackpot {
    font-size: 3em;
    color: #ff00ff;
    text-shadow: 0 0 30px #ff00ff, 0 0 60px #ff0088;
    display: none;
    animation: flash 1s infinite alternate;
  }

  @keyframes flash {
    0% { opacity: 1; transform: scale(1); }
    100% { opacity: 0.5; transform: scale(1.1); }
  }

  audio { display: none; }
</style>
</head>
<body>
  <h1>üíé Diamond Slots üíé</h1>
  <div id="slot-container">
    <div class="reel" id="r1">üíé</div>
    <div class="reel" id="r2">üíé</div>
    <div class="reel" id="r3">üíé</div>
  </div>

  <button id="spinBtn">SPIN</button>
  <div id="diamond-display">Diamonds: <span id="diamonds">0</span></div>
  <div id="jackpot">JACKPOT!!! üí•</div>

  <audio id="spinSound" src="https://cdn.pixabay.com/download/audio/2022/03/15/audio_b50a1aebc0.mp3?filename=slot-machine-spin-102441.mp3"></audio>
  <audio id="jackpotSound" src="https://cdn.pixabay.com/download/audio/2022/03/15/audio_4c772a98f2.mp3?filename=casino-win-102443.mp3"></audio>

<script type="module">
  // Firebase imports
  import { initializeApp } from "https://www.gstatic.com/firebasejs/12.4.0/firebase-app.js";
  import { getFirestore, doc, getDoc, setDoc, updateDoc } from "https://www.gstatic.com/firebasejs/12.4.0/firebase-firestore.js";

  // Firebase config (your existing project)
  const firebaseConfig = {
    apiKey: "AIzaSyB9HCPLU-mcEGZjabMjkkcCqN9h5p6xAi4",
    authDomain: "diamond-slots-5a068.firebaseapp.com",
    projectId: "diamond-slots-5a068",
    storageBucket: "diamond-slots-5a068.firebasestorage.app",
    messagingSenderId: "793464458639",
    appId: "1:793464458639:web:7f709a2166eb49a1a34ffa",
    measurementId: "G-1PKDW5S5J5"
  };

  const app = initializeApp(firebaseConfig);
  const db = getFirestore(app);

  // üîπ Player system
  async function loadOrCreatePlayer(name) {
    const playerRef = doc(db, "players", name);
    const snap = await getDoc(playerRef);
    if (snap.exists()) {
      console.log("Returning player:", name);
      return snap.data();
    } else {
      console.log("New player created:", name);
      const newPlayer = {
        name: name,
        diamonds: 10000,
        xp: 0,
        level: 1,
        prestige: 0,
        powerUps: { luck: 0, speed: 0, xp: 0 },
        createdAt: new Date().toISOString()
      };
      await setDoc(playerRef, newPlayer);
      return newPlayer;
    }
  }

  async function savePlayerData(player) {
    const playerRef = doc(db, "players", player.name);
    await updateDoc(playerRef, player);
    console.log("Player saved:", player.name);
  }

  // üé∞ Game logic
  const symbols = ["üíé", "üçí", "7Ô∏è‚É£", "‚≠ê", "üîî", "üçÄ"];
  const reels = [document.getElementById("r1"), document.getElementById("r2"), document.getElementById("r3")];
  const spinBtn = document.getElementById("spinBtn");
  const diamondDisplay = document.getElementById("diamonds");
  const jackpotBanner = document.getElementById("jackpot");
  const spinSound = document.getElementById("spinSound");
  const jackpotSound = document.getElementById("jackpotSound");

  let player;

  async function initGame() {
    const playerName = prompt("Enter your player name:") || "Guest";
    player = await loadOrCreatePlayer(playerName);
    diamondDisplay.textContent = player.diamonds;
  }

  function playSound(sound) {
    sound.currentTime = 0;
    sound.play();
  }

  function randomSymbol() {
    return symbols[Math.floor(Math.random() * symbols.length)];
  }

  async function spin() {
    if (player.diamonds < 100) {
      alert("Not enough diamonds! üíé");
      return;
    }

    playSound(spinSound);
    player.diamonds -= 100;

    for (let i = 0; i < reels.length; i++) {
      reels[i].textContent = symbols[Math.floor(Math.random() * symbols.length)];
    }

    await new Promise(resolve => setTimeout(resolve, 1000));

    const results = reels.map(r => r.textContent);
    diamondDisplay.textContent = player.diamonds;

    // Jackpot if all symbols match
    if (results[0] === results[1] && results[1] === results[2]) {
      jackpotBanner.style.display = "block";
      playSound(jackpotSound);
      const reward = Math.floor(Math.random() * 5000) + 2000;
      player.diamonds += reward;
      setTimeout(() => (jackpotBanner.style.display = "none"), 4000);
    }

    diamondDisplay.textContent = player.diamonds;
    await savePlayerData(player);
  }

  spinBtn.addEventListener("click", spin);
  initGame();
</script>
</body>
</html>
